---
- name: Deploy Nginx web servers
  hosts: localhost
  become: true

  tasks:
    - name: Apply nginx webserver
      command: kubectl apply -f "{{ k8s_dir }}/nginx/webserver.yml"
      environment:
        KUBECONFIG: "{{ kubeconfig }}"

    - name: Wait for nginx webserver rollout
      command: kubectl rollout status deployment/nginx-webserver -n web --timeout=180s
      environment:
        KUBECONFIG: "{{ kubeconfig }}"

    - name: Apply nginx proxy
      command: kubectl apply -f "{{ k8s_dir }}/nginx/proxy.yml"
      environment:
        KUBECONFIG: "{{ kubeconfig }}"

    - name: Wait for nginx proxy rollout
      command: kubectl rollout status deployment/nginx-proxy -n web --timeout=180s
      environment:
        KUBECONFIG: "{{ kubeconfig }}"
